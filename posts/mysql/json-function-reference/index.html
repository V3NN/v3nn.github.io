<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>一问了解MySQL JSON相关函数 - V3NN</title><meta name="Description" content="这篇文章展示了MySQL JSON相关函数."><meta property="og:title" content="一问了解MySQL JSON相关函数" />
<meta property="og:description" content="这篇文章展示了MySQL JSON相关函数." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://example.org/posts/mysql/json-function-reference/" /><meta property="og:image" content="http://example.org/logo.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-01T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-12-01T00:00:00+00:00" /><meta property="og:site_name" content="我的网站" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="http://example.org/logo.png"/>

<meta name="twitter:title" content="一问了解MySQL JSON相关函数"/>
<meta name="twitter:description" content="这篇文章展示了MySQL JSON相关函数."/>
<meta name="application-name" content="My cool site">
<meta name="apple-mobile-web-app-title" content="My cool site"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://example.org/posts/mysql/json-function-reference/" /><link rel="prev" href="http://example.org/posts/my-first-post/" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "一问了解MySQL JSON相关函数",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/example.org\/posts\/mysql\/json-function-reference\/"
        },"genre": "posts","keywords": "MySQL, JSON","wordcount":  2127 ,
        "url": "http:\/\/example.org\/posts\/mysql\/json-function-reference\/","datePublished": "2023-12-01T00:00:00+00:00","dateModified": "2023-12-01T00:00:00+00:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "V3NN"
            },"description": "这篇文章展示了MySQL JSON相关函数."
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="V3NN">V3NN</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> 文章 </a><a class="menu-item" href="/tags/"> 标签 </a><a class="menu-item" href="/categories/"> 分类 </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="V3NN">V3NN</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/" title="">文章</a><a class="menu-item" href="/tags/" title="">标签</a><a class="menu-item" href="/categories/" title="">分类</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">一问了解MySQL JSON相关函数</h1><div class="post-meta">
            
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2023-12-01">2023-12-01</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;2127 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;10 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#1-介绍">1. 介绍</a></li>
    <li><a href="#2-创建json">2. 创建JSON</a>
      <ul>
        <li><a href="#json_array">JSON_ARRAY</a></li>
        <li><a href="#json_object">JSON_OBJECT</a></li>
      </ul>
    </li>
    <li><a href="#3-搜索json">3. 搜索JSON</a>
      <ul>
        <li><a href="#json_contains">JSON_CONTAINS</a></li>
        <li><a href="#json_contains_path">JSON_CONTAINS_PATH</a></li>
        <li><a href="#json_extract">JSON_EXTRACT</a></li>
        <li><a href="#member-of">MEMBER OF</a></li>
      </ul>
    </li>
    <li><a href="#4-修改json">4. 修改JSON</a>
      <ul>
        <li><a href="#json_array_append">JSON_ARRAY_APPEND</a></li>
        <li><a href="#json_array_insert">JSON_ARRAY_INSERT</a></li>
        <li><a href="#json_insert">JSON_INSERT</a></li>
        <li><a href="#json_merge_patch">JSON_MERGE_PATCH</a></li>
        <li><a href="#json_merge_preserve">JSON_MERGE_PRESERVE</a></li>
        <li><a href="#json_remove">JSON_REMOVE</a></li>
        <li><a href="#json_replace">JSON_REPLACE</a></li>
        <li><a href="#json_set">JSON_SET</a></li>
      </ul>
    </li>
    <li><a href="#5-获取json文本属性">5. 获取JSON文本属性</a>
      <ul>
        <li><a href="#json_depth">JSON_DEPTH</a></li>
        <li><a href="#json_length">JSON_LENGTH</a></li>
        <li><a href="#json_type">JSON_TYPE</a></li>
        <li><a href="#json_valid">JSON_VALID</a></li>
      </ul>
    </li>
    <li><a href="#6-json聚合函数">6. JSON聚合函数</a>
      <ul>
        <li><a href="#json_arrayagg">JSON_ARRAYAGG</a></li>
        <li><a href="#json_objectagg">JSON_OBJECTAGG</a></li>
      </ul>
    </li>
    <li><a href="#7-相关文档">7. 相关文档</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h2 id="1-介绍">1. 介绍</h2>
<p><code>JSON(JavaScript Object Notation)</code> 是一种轻量级的数据交换格式，目前常用于前后段数据传输。</p>
<p><code>MySQL</code> 从 <code>5.7.8</code> 版本开始提供<code> JSON</code> 数据类型及相关函数，其通过新增<code>JSON</code>对象类型和相应的函数来解析和生成 <code>JSON</code>格式数据，使得 <code>MySQL</code> 在处理 <code>JSON</code>数据方面更加高效便捷，以下介绍常用相关函数。</p>
<h2 id="2-创建json">2. 创建JSON</h2>
<h3 id="json_array">JSON_ARRAY</h3>
<p><code>JSON_ARRAY([val[, val] ...])</code></p>
<p>接受一个值列表(可能为<code>NULL</code>)，并返回一个包含这些值的 <code>JSON</code> 数组</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_ARRAY</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;abc&#34;</span><span class="p">,</span><span class="w"> </span><span class="no">NULL</span><span class="p">,</span><span class="w"> </span><span class="no">TRUE</span><span class="p">,</span><span class="w"> </span><span class="nf">CURTIME</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+---------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_ARRAY</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;abc&#34;</span><span class="p">,</span><span class="w"> </span><span class="no">NULL</span><span class="p">,</span><span class="w"> </span><span class="no">TRUE</span><span class="p">,</span><span class="w"> </span><span class="nf">CURTIME</span><span class="p">())</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+---------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;abc&#34;</span><span class="p">,</span><span class="w"> </span><span class="no">null</span><span class="p">,</span><span class="w"> </span><span class="no">true</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;11:30:24.000000&#34;</span><span class="p">]</span><span class="w">   </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+---------------------------------------------+</span><span class="w">
</span></span></span></code></pre></div><h3 id="json_object">JSON_OBJECT</h3>
<p><code>JSON_OBJECT([key, val[, key, val] ...])</code></p>
<p>接受一个键值对(可以为<code>NULL</code>)列表，并返回一个包含这些键值对的 <code>JSON</code> 对象</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_OBJECT</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">87</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;carrot&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;addr&#39;</span><span class="p">,</span><span class="w"> </span><span class="no">null</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+--------------------------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_OBJECT</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">87</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;carrot&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;addr&#39;</span><span class="p">,</span><span class="w"> </span><span class="no">null</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+--------------------------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="s2">&#34;id&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">87</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;addr&#34;</span><span class="p">:</span><span class="w"> </span><span class="no">null</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;name&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;carrot&#34;</span><span class="err">}</span><span class="w">                   </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+--------------------------------------------------------------+</span><span class="w">
</span></span></span></code></pre></div><h2 id="3-搜索json">3. 搜索JSON</h2>
<h3 id="json_contains">JSON_CONTAINS</h3>
<p><code>JSON_CONTAINS(target, candidate[, path])</code></p>
<p>该函数用于检查 <code>candidate</code> 是否包含在 <code>target</code> 文档当中，或者是否在目标文档的指定路径上查找指定元素 （提供了<code>path</code>）。如果<code>target</code>文档包含了<code>candidate</code>，该函数返回 <code>1</code> , 否则返回<code>0</code></p>
<ul>
<li><code>target</code> 和 <code>candidate</code>参数要使用单引号括住</li>
<li><code>target</code> 和 <code>candidate</code>参数必须是有效的<code>JSON</code>文档</li>
<li><code>path</code> 参数必须是有效的路径表达式，不能包含 <code>*</code> 或者 <code>**</code> 等通配符</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="kt">SET</span><span class="w"> </span><span class="o">@</span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;{&#34;a&#34;: 1, &#34;b&#34;: 2, &#34;c&#34;: {&#34;d&#34;: 4}}&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="kt">SET</span><span class="w"> </span><span class="o">@</span><span class="n">j2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;1&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_CONTAINS</span><span class="p">(</span><span class="o">@</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">j2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.a&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+-------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_CONTAINS</span><span class="p">(</span><span class="o">@</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">j2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.a&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+-------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">                             </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+-------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_CONTAINS</span><span class="p">(</span><span class="o">@</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">j2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.b&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+-------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_CONTAINS</span><span class="p">(</span><span class="o">@</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">j2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.b&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+-------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">                             </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+-------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="kt">SET</span><span class="w"> </span><span class="o">@</span><span class="n">j2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;{&#34;d&#34;: 4}&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_CONTAINS</span><span class="p">(</span><span class="o">@</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">j2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.a&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+-------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_CONTAINS</span><span class="p">(</span><span class="o">@</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">j2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.a&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+-------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">                             </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+-------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_CONTAINS</span><span class="p">(</span><span class="o">@</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">j2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.c&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+-------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_CONTAINS</span><span class="p">(</span><span class="o">@</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">j2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.c&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+-------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">                             </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+-------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_CONTAINS</span><span class="p">(</span><span class="s1">&#39;{&#34;a&#34;:1, &#34;b&#34;:&#34;2&#34;, &#34;c&#34;:{&#34;d&#34;:4, &#34;e&#34;:&#34;2&#34;, &#34;f&#34;:{ &#34;g&#34;: &#34;2&#34;}}}&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#34;2&#34;&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.c.f.g&#39;</span><span class="p">)</span><span class="w"> </span><span class="n">res</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+-------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="n">res</span><span class="w">							</span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+-------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">                             </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+-----------------------------</span><span class="c1">--
</span></span></span></code></pre></div><h3 id="json_contains_path">JSON_CONTAINS_PATH</h3>
<p><code>JSON_CONTAINS_PATH(json_doc, one_or_all, path[, path] ...)</code></p>
<p>该函数用于检验一个或多个指定的路径（<code>key</code>）是否包含于目标 <code>json_doc</code>中。如果包含在目标中，该函数返回 <code>1</code>，否则返回 <code>0</code></p>
<ul>
<li>
<p><code>json_doc</code> 参数必须一个有效的<code>JSON</code>文档，否则报错</p>
</li>
<li>
<p><code>one_or_all</code> 参数必须为 <code>one</code> 或者<code>all</code>,</p>
<p>传递 <code>one</code> 如果文档中至少存在一个路径，则返回 1，否则返回 0</p>
<p>传递 <code>all</code> 如果文档中存在所有路径，则返回 1，否则返回 0</p>
</li>
<li>
<p><code>path </code> 为有效的路径表达式</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="kt">SET</span><span class="w"> </span><span class="o">@</span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;{&#34;a&#34;: 1, &#34;b&#34;: 2, &#34;c&#34;: {&#34;d&#34;: 4}}&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_CONTAINS_PATH</span><span class="p">(</span><span class="o">@</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;one&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.a&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.e&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+---------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_CONTAINS_PATH</span><span class="p">(</span><span class="o">@</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;one&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.a&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.e&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+---------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">                                           </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+---------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_CONTAINS_PATH</span><span class="p">(</span><span class="o">@</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.a&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.e&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+---------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_CONTAINS_PATH</span><span class="p">(</span><span class="o">@</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.a&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.e&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+---------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">                                           </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+---------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_CONTAINS_PATH</span><span class="p">(</span><span class="o">@</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;one&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.c.d&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+----------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_CONTAINS_PATH</span><span class="p">(</span><span class="o">@</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;one&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.c.d&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+----------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">                                      </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+----------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_CONTAINS_PATH</span><span class="p">(</span><span class="o">@</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;one&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.a.d&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+----------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_CONTAINS_PATH</span><span class="p">(</span><span class="o">@</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;one&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.a.d&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+----------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">                                      </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+----------------------------------------+</span><span class="w">
</span></span></span></code></pre></div><h3 id="json_extract">JSON_EXTRACT</h3>
<p><code>JSON_EXTRACT(json_doc, path[, path] ...)</code></p>
<p>该函数用于从<code> json_doc</code> 中指定的 <code>path</code> 返回数据( <code>path</code> 可以传递<code>*</code> 匹配所有元素)，如果任何参数为 <code>NULL</code> 或在文档中没有定位到路径，则返回 <code>NULL</code></p>
<pre tabindex="0"><code>
# 查询json_doc中索引为1的值
mysql&gt; SELECT JSON_EXTRACT(&#39;[10, 20, [30, 40]]&#39;, &#39;$[1]&#39;);
+--------------------------------------------+
| JSON_EXTRACT(&#39;[10, 20, [30, 40]]&#39;, &#39;$[1]&#39;) |
+--------------------------------------------+
| 20                                         |
+--------------------------------------------+

# 查询json_doc中索引为1和0的值
mysql&gt; SELECT JSON_EXTRACT(&#39;[10, 20, [30, 40]]&#39;, &#39;$[1]&#39;, &#39;$[0]&#39;);
+----------------------------------------------------+
| JSON_EXTRACT(&#39;[10, 20, [30, 40]]&#39;, &#39;$[1]&#39;, &#39;$[0]&#39;) |
+----------------------------------------------------+
| [20, 10]                                           |
+----------------------------------------------------+

# 查询json_doc中索引为2的所有值
mysql&gt; SELECT JSON_EXTRACT(&#39;[10, 20, [30, 40]]&#39;, &#39;$[2][*]&#39;);
+-----------------------------------------------+
| JSON_EXTRACT(&#39;[10, 20, [30, 40]]&#39;, &#39;$[2][*]&#39;) |
+-----------------------------------------------+
| [30, 40]                                      |
+-----------------------------------------------+

# 查询json_doc中key为c的值
mysql&gt; SELECT JSON_EXTRACT(&#39;{&#34;a&#34;: 1, &#34;b&#34;: 2, &#34;c&#34;: {&#34;d&#34;: 4, &#34;e&#34;:[{&#34;f&#34;:5}]}}&#39;, &#39;$.c&#39;)
+-----------------------------------------------------------------------+
| JSON_EXTRACT(&#39;{&#34;a&#34;: 1, &#34;b&#34;: 2, &#34;c&#34;: {&#34;d&#34;: 4, &#34;e&#34;:[{&#34;f&#34;:5}]}}&#39;, &#39;$.c&#39;) |
+-----------------------------------------------------------------------+
| {&#34;d&#34;: 4, &#34;e&#34;: [{&#34;f&#34;: 5}]}                                             |
+-----------------------------------------------------------------------+

# 查询json_doc中key为c中e的值
mysql&gt; SELECT JSON_EXTRACT(&#39;{&#34;a&#34;: 1, &#34;b&#34;: 2, &#34;c&#34;: {&#34;d&#34;: 4, &#34;e&#34;:[{&#34;f&#34;:5}]}}&#39;, &#39;$.c.e&#39;)
+-------------------------------------------------------------------------+
| JSON_EXTRACT(&#39;{&#34;a&#34;: 1, &#34;b&#34;: 2, &#34;c&#34;: {&#34;d&#34;: 4, &#34;e&#34;:[{&#34;f&#34;:5}]}}&#39;, &#39;$.c.e&#39;) |
+-------------------------------------------------------------------------+
| [{&#34;f&#34;: 5}]                                          		 			  |
+-------------------------------------------------------------------------+

# 查询json_doc中key为aa的值
mysql&gt; SELECT JSON_EXTRACT(&#39;{&#34;a&#34;: 1, &#34;b&#34;: 2, &#34;c&#34;: {&#34;d&#34;: 4, &#34;e&#34;:[{&#34;f&#34;:5}]}}&#39;, &#39;$.c.e&#39;)
+-------------------------------------------------------------------------+
| JSON_EXTRACT(&#39;{&#34;a&#34;: 1, &#34;b&#34;: 2, &#34;c&#34;: {&#34;d&#34;: 4, &#34;e&#34;:[{&#34;f&#34;:5}]}}&#39;, &#39;$.aa&#39;)  |
+-------------------------------------------------------------------------+
| NULL                                       		 			          |
+-------------------------------------------------------------------------+

# 查询json_doc中key为a的值
mysql&gt; SELECT JSON_EXTRACT(&#39;{&#34;a&#34;: 1, &#34;b&#34;: 2, &#34;c&#34;: {&#34;d&#34;: 4, &#34;e&#34;:[{&#34;f&#34;:5}]}}&#39;, &#39;$.a&#39;)
+-------------------------------------------------------------------------+
| JSON_EXTRACT(&#39;{&#34;a&#34;: 1, &#34;b&#34;: 2, &#34;c&#34;: {&#34;d&#34;: 4, &#34;e&#34;:[{&#34;f&#34;:5}]}}&#39;, &#39;$.aa&#39;)  |
+-------------------------------------------------------------------------+
| NULL                                       		 			          |
+-------------------------------------------------------------------------+
</code></pre><h3 id="member-of">MEMBER OF</h3>
<p><code>value MEMBER OF(json array)</code></p>
<p>如果被检索的元素和 <code>JSON</code>数组中的任意一个元素相同，则该函数返回 1，否则返回 0</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">17</span><span class="w"> </span><span class="n">MEMBER</span><span class="w"> </span><span class="nf">OF</span><span class="p">(</span><span class="s1">&#39;[23, &#34;abc&#34;, 17, &#34;ab&#34;, 10]&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+-------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="mi">17</span><span class="w"> </span><span class="n">MEMBER</span><span class="w"> </span><span class="nf">OF</span><span class="p">(</span><span class="s1">&#39;[23, &#34;abc&#34;, 17, &#34;ab&#34;, 10]&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+-------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">                                         </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+-------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">1</span><span class="w"> </span><span class="n">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;ab&#39;</span><span class="w"> </span><span class="n">MEMBER</span><span class="w"> </span><span class="nf">OF</span><span class="p">(</span><span class="s1">&#39;[23, &#34;abc&#34;, 17, &#34;ab&#34;, 10]&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+---------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;ab&#39;</span><span class="w"> </span><span class="n">MEMBER</span><span class="w"> </span><span class="nf">OF</span><span class="p">(</span><span class="s1">&#39;[23, &#34;abc&#34;, 17, &#34;ab&#34;, 10]&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+---------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">                                           </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+---------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">1</span><span class="w"> </span><span class="n">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></div><h2 id="4-修改json">4. 修改JSON</h2>
<h3 id="json_array_append">JSON_ARRAY_APPEND</h3>
<p><code>JSON_ARRAY_APPEND(json_doc, path, val[, path, val] ...)</code></p>
<p>该函数用于将指定的值附加到 <code>json_doc</code> 中指定数组的末尾并返回结果</p>
<p>如果路径对应的值是一个标量或对象值，则该值将自动包裹在数组中，并将新值添加到该数组中</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="kt">SET</span><span class="w"> </span><span class="o">@</span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;[&#34;a&#34;, [&#34;b&#34;, &#34;c&#34;], &#34;d&#34;]&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_ARRAY_APPEND</span><span class="p">(</span><span class="o">@</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$[1]&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+----------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_ARRAY_APPEND</span><span class="p">(</span><span class="o">@</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$[1]&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+----------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;a&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;b&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;c&#34;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="s2">&#34;d&#34;</span><span class="p">]</span><span class="w">        </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+----------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_ARRAY_APPEND</span><span class="p">(</span><span class="o">@</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$[0]&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+----------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_ARRAY_APPEND</span><span class="p">(</span><span class="o">@</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$[0]&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+----------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="p">[[</span><span class="s2">&#34;a&#34;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;b&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;c&#34;</span><span class="p">],</span><span class="w"> </span><span class="s2">&#34;d&#34;</span><span class="p">]</span><span class="w">      </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+----------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_ARRAY_APPEND</span><span class="p">(</span><span class="o">@</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$[1][0]&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+-------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_ARRAY_APPEND</span><span class="p">(</span><span class="o">@</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$[1][0]&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+-------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;a&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">[[</span><span class="s2">&#34;b&#34;</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">],</span><span class="w"> </span><span class="s2">&#34;c&#34;</span><span class="p">],</span><span class="w"> </span><span class="s2">&#34;d&#34;</span><span class="p">]</span><span class="w">         </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+-------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="kt">SET</span><span class="w"> </span><span class="o">@</span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;{&#34;a&#34;: 1, &#34;b&#34;: [2, 3], &#34;c&#34;: 4}&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_ARRAY_APPEND</span><span class="p">(</span><span class="o">@</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.b&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;x&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_ARRAY_APPEND</span><span class="p">(</span><span class="o">@</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.b&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;x&#39;</span><span class="p">)</span><span class="w">  </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="s2">&#34;a&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;b&#34;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;x&#34;</span><span class="p">],</span><span class="w"> </span><span class="s2">&#34;c&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="err">}</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_ARRAY_APPEND</span><span class="p">(</span><span class="o">@</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.c&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;y&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+--------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_ARRAY_APPEND</span><span class="p">(</span><span class="o">@</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.c&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;y&#39;</span><span class="p">)</span><span class="w">    </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+--------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="s2">&#34;a&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;b&#34;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">],</span><span class="w"> </span><span class="s2">&#34;c&#34;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;y&#34;</span><span class="p">]</span><span class="err">}</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+--------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="kt">SET</span><span class="w"> </span><span class="o">@</span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;{&#34;a&#34;: 1}&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_ARRAY_APPEND</span><span class="p">(</span><span class="o">@</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;z&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+---------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_ARRAY_APPEND</span><span class="p">(</span><span class="o">@</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;z&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+---------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="p">[</span><span class="err">{</span><span class="s2">&#34;a&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="err">}</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;z&#34;</span><span class="p">]</span><span class="w">                 </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+---------------------------------+</span><span class="w">
</span></span></span></code></pre></div><h3 id="json_array_insert">JSON_ARRAY_INSERT</h3>
<p><code>JSON_ARRAY_INSERT(json_doc, path, val[, path, val] ...)</code></p>
<p>该函数用于将数组插入<code>json_doc</code> 中并返回修改后的文档</p>
<p>如果路径识别了某一数组元素，则在该元素位置插入相应的值，将所有后续值向右移动；如果路径识别的数组位置超出数组末尾的位置，则将值插入到数组末尾</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="kt">SET</span><span class="w"> </span><span class="o">@</span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;[&#34;a&#34;, {&#34;b&#34;: [1, 2]}, [3, 4]]&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_ARRAY_INSERT</span><span class="p">(</span><span class="o">@</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$[1]&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;x&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_ARRAY_INSERT</span><span class="p">(</span><span class="o">@</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$[1]&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;x&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;a&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;x&#34;</span><span class="p">,</span><span class="w"> </span><span class="err">{</span><span class="s2">&#34;b&#34;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">]</span><span class="err">}</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">]]</span><span class="w">  </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_ARRAY_INSERT</span><span class="p">(</span><span class="o">@</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$[100]&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;x&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+--------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_ARRAY_INSERT</span><span class="p">(</span><span class="o">@</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$[100]&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;x&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+--------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;a&#34;</span><span class="p">,</span><span class="w"> </span><span class="err">{</span><span class="s2">&#34;b&#34;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">]</span><span class="err">}</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">],</span><span class="w"> </span><span class="s2">&#34;x&#34;</span><span class="p">]</span><span class="w">    </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+--------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_ARRAY_INSERT</span><span class="p">(</span><span class="o">@</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$[1].b[0]&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;x&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+-----------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_ARRAY_INSERT</span><span class="p">(</span><span class="o">@</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$[1].b[0]&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;x&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+-----------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;a&#34;</span><span class="p">,</span><span class="w"> </span><span class="err">{</span><span class="s2">&#34;b&#34;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;x&#34;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">]</span><span class="err">}</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">]]</span><span class="w">       </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+-----------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_ARRAY_INSERT</span><span class="p">(</span><span class="o">@</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$[2][1]&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;y&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+---------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_ARRAY_INSERT</span><span class="p">(</span><span class="o">@</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$[2][1]&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;y&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+---------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;a&#34;</span><span class="p">,</span><span class="w"> </span><span class="err">{</span><span class="s2">&#34;b&#34;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">]</span><span class="err">}</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;y&#34;</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">]]</span><span class="w">     </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+---------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_ARRAY_INSERT</span><span class="p">(</span><span class="o">@</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$[0]&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$[2][1]&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;y&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+----------------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_ARRAY_INSERT</span><span class="p">(</span><span class="o">@</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$[0]&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$[2][1]&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;y&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+----------------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;x&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;a&#34;</span><span class="p">,</span><span class="w"> </span><span class="err">{</span><span class="s2">&#34;b&#34;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">]</span><span class="err">}</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">]]</span><span class="w">                  </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+----------------------------------------------------+</span><span class="w">
</span></span></span></code></pre></div><h3 id="json_insert">JSON_INSERT</h3>
<p><code>JSON_INSERT(json_doc, path, val[, path, val] ...)</code></p>
<p>该函数将数据插入 <code>json_doc</code>并返回结果，<code>path</code>有值不覆盖，没值就添加</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_INSERT</span><span class="p">(</span><span class="s1">&#39;{ &#34;a&#34;: 1, &#34;b&#34;: [2, 3]}&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.a&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.c&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;[true, false]&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+--------------------------------------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_INSERT</span><span class="p">(</span><span class="s1">&#39;{ &#34;a&#34;: 1, &#34;b&#34;: [2, 3]}&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.a&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.c&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;[true, false]&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+--------------------------------------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="s2">&#34;a&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;b&#34;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">],</span><span class="w"> </span><span class="s2">&#34;c&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;[true, false]&#34;</span><span class="err">}</span><span class="w">                              </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+--------------------------------------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_INSERT</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;{ &#34;a&#34;: 1, &#34;b&#34;: [2, 3],&#34;c&#34;:666}&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.a&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.c&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">999</span><span class="w"> </span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+------------------------------------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_INSERT</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;{ &#34;a&#34;: 1, &#34;b&#34;: [2, 3],&#34;c&#34;:666}&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.a&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.c&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">999</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+------------------------------------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="s2">&#34;a&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;b&#34;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">],</span><span class="w"> </span><span class="s2">&#34;c&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">666</span><span class="err">}</span><span class="w">                                        </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+------------------------------------------------------------------------+</span><span class="w">
</span></span></span></code></pre></div><h3 id="json_merge_patch">JSON_MERGE_PATCH</h3>
<p><code>JSON_MERGE_PATCH(json_doc, json_doc[, json_doc] ...)</code></p>
<p>该函数依据 <code>RFC 7396</code> 标准对两个或多个<code>json_doc</code>执行合并，并返回合并结果，结果不保留具有重复键的成员</p>
<p>如果某一个参数所传递的文档无效，则会引发错误</p>
<p><code>JSON_MERGE_PATCH()</code>按如下方式执行合并：</p>
<ul>
<li>如果第一个参数不是对象，则将其视为空对象与第二个参数合并作为合并结果。</li>
<li>如果第二个参数不是对象，则合并结果是第二个参数。</li>
<li>如果两个参数都是对象，则合并的结果是具有以下成员的对象：
<ul>
<li>第一个对象的所有成员在第二个对象中没有具有相同键的对应成员。</li>
<li>第二个对象的所有成员在第一个对象中没有对应的键，并且其值不是 <code>JSON</code> 的 <code>null</code> 字面量。</li>
<li>所有成员的键都存在于第一个和第二个对象中，并且在第二个对象中的值不是 <code>JSON </code> 的 <code>null</code> 字面量。 这些成员的值是递归合并第一个对象中的值与第二个对象中的值的结果。</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_MERGE_PATCH</span><span class="p">(</span><span class="s1">&#39;[1, 2]&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;[true, false]&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+---------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_MERGE_PATCH</span><span class="p">(</span><span class="s1">&#39;[1, 2]&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;[true, false]&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+---------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="p">[</span><span class="no">true</span><span class="p">,</span><span class="w"> </span><span class="no">false</span><span class="p">]</span><span class="w">                               </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+---------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_MERGE_PATCH</span><span class="p">(</span><span class="s1">&#39;{&#34;name&#34;: &#34;x&#34;}&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;{&#34;id&#34;: 47}&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+-------------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_MERGE_PATCH</span><span class="p">(</span><span class="s1">&#39;{&#34;name&#34;: &#34;x&#34;}&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;{&#34;id&#34;: 47}&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+-------------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="s2">&#34;id&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">47</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;name&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;x&#34;</span><span class="err">}</span><span class="w">                         </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+-------------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_MERGE_PATCH</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;true&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+-------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_MERGE_PATCH</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;true&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+-------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="no">true</span><span class="w">                          </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+-------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_MERGE_PATCH</span><span class="p">(</span><span class="s1">&#39;[1, 2]&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;{&#34;id&#34;: 47}&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_MERGE_PATCH</span><span class="p">(</span><span class="s1">&#39;[1, 2]&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;{&#34;id&#34;: 47}&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="s2">&#34;id&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">47</span><span class="err">}</span><span class="w">                               </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_MERGE_PATCH</span><span class="p">(</span><span class="s1">&#39;{ &#34;a&#34;: 1, &#34;b&#34;:2 }&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="o">&gt;</span><span class="w">     </span><span class="s1">&#39;{ &#34;a&#34;: 3, &#34;c&#34;:4 }&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+-----------------------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_MERGE_PATCH</span><span class="p">(</span><span class="s1">&#39;{ &#34;a&#34;: 1, &#34;b&#34;:2 }&#39;</span><span class="p">,</span><span class="s1">&#39;{ &#34;a&#34;: 3, &#34;c&#34;:4 }&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+-----------------------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="s2">&#34;a&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;b&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;c&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="err">}</span><span class="w">                                  </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+-----------------------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_MERGE_PATCH</span><span class="p">(</span><span class="s1">&#39;{ &#34;a&#34;: 1, &#34;b&#34;:2 }&#39;</span><span class="p">,</span><span class="s1">&#39;{ &#34;a&#34;: 3, &#34;c&#34;:4 }&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="o">&gt;</span><span class="w">     </span><span class="s1">&#39;{ &#34;a&#34;: 5, &#34;d&#34;:6 }&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+-------------------------------------------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_MERGE_PATCH</span><span class="p">(</span><span class="s1">&#39;{ &#34;a&#34;: 1, &#34;b&#34;:2 }&#39;</span><span class="p">,</span><span class="s1">&#39;{ &#34;a&#34;: 3, &#34;c&#34;:4 }&#39;</span><span class="p">,</span><span class="s1">&#39;{ &#34;a&#34;: 5, &#34;d&#34;:6 }&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+-------------------------------------------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="s2">&#34;a&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;b&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;c&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;d&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="err">}</span><span class="w">                                              </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+-------------------------------------------------------------------------------+</span><span class="w">
</span></span></span></code></pre></div><p>可以使用此函数通过在第二个参数中指定同一成员的值 来删除成员 ，如下所示：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_MERGE_PATCH</span><span class="p">(</span><span class="s1">&#39;{&#34;a&#34;:1, &#34;b&#34;:2}&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;{&#34;b&#34;:null}&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+--------------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_MERGE_PATCH</span><span class="p">(</span><span class="s1">&#39;{&#34;a&#34;:1, &#34;b&#34;:2}&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;{&#34;b&#34;:null}&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+--------------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="s2">&#34;a&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="err">}</span><span class="w">                                         </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+--------------------------------------------------+</span><span class="w">
</span></span></span></code></pre></div><p>另外该函数是以递归方式运行，也就是说，成员的值不限于标量，它们本身也可以是<code>json_doc</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_MERGE_PATCH</span><span class="p">(</span><span class="s1">&#39;{&#34;a&#34;:{&#34;x&#34;:1}}&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;{&#34;a&#34;:{&#34;y&#34;:2}}&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+----------------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_MERGE_PATCH</span><span class="p">(</span><span class="s1">&#39;{&#34;a&#34;:{&#34;x&#34;:1}}&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;{&#34;a&#34;:{&#34;y&#34;:2}}&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+----------------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="s2">&#34;a&#34;</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="s2">&#34;x&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;y&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="err">}}</span><span class="w">                            </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+----------------------------------------------------+</span><span class="w">
</span></span></span></code></pre></div><h3 id="json_merge_preserve">JSON_MERGE_PRESERVE</h3>
<p><code>JSON_MERGE_PRESERVE(json_doc, json_doc[, json_doc] ...)</code></p>
<p>合并两个或多个<code>json_doc</code> 并返回合并结果，如果任何参数为 <code>NULL</code>，则返回 <code>NULL</code>。如果任何参数不是有效的 <code>json_doc</code>，则会报错。</p>
<p><code>JSON_MERGE_PRESERVE()</code> 按如下方式执行合并：</p>
<ul>
<li>相邻数组合并为一个数组。</li>
<li>相邻的对象合并为一个对象。</li>
<li>标量值自动包裹为数组并且合并为数组。</li>
<li>通过将对象自动包裹为数组来合并相邻的数组和对象。</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_MERGE_PRESERVE</span><span class="p">(</span><span class="s1">&#39;[1, 2]&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;[true, false]&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+------------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_MERGE_PRESERVE</span><span class="p">(</span><span class="s1">&#39;[1, 2]&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;[true, false]&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+------------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="no">true</span><span class="p">,</span><span class="w"> </span><span class="no">false</span><span class="p">]</span><span class="w">                            </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+------------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_MERGE_PRESERVE</span><span class="p">(</span><span class="s1">&#39;{&#34;name&#34;: &#34;x&#34;}&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;{&#34;id&#34;: 47}&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+----------------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_MERGE_PRESERVE</span><span class="p">(</span><span class="s1">&#39;{&#34;name&#34;: &#34;x&#34;}&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;{&#34;id&#34;: 47}&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+----------------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="s2">&#34;id&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">47</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;name&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;x&#34;</span><span class="err">}</span><span class="w">                            </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+----------------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_MERGE_PRESERVE</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;true&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+----------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_MERGE_PRESERVE</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;true&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+----------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="no">true</span><span class="p">]</span><span class="w">                        </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+----------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_MERGE_PRESERVE</span><span class="p">(</span><span class="s1">&#39;[1, 2]&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;{&#34;id&#34;: 47}&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+---------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_MERGE_PRESERVE</span><span class="p">(</span><span class="s1">&#39;[1, 2]&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;{&#34;id&#34;: 47}&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+---------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="err">{</span><span class="s2">&#34;id&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">47</span><span class="err">}</span><span class="p">]</span><span class="w">                          </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+---------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_MERGE_PRESERVE</span><span class="p">(</span><span class="s1">&#39;{ &#34;a&#34;: 1, &#34;b&#34;: 2 }&#39;</span><span class="p">,</span><span class="s1">&#39;{ &#34;a&#34;: 3, &#34;c&#34;: 4 }&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+--------------------------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_MERGE_PRESERVE</span><span class="p">(</span><span class="s1">&#39;{ &#34;a&#34;: 1, &#34;b&#34;: 2 }&#39;</span><span class="p">,</span><span class="s1">&#39;{ &#34;a&#34;: 3, &#34;c&#34;:4 }&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+--------------------------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="s2">&#34;a&#34;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">],</span><span class="w"> </span><span class="s2">&#34;b&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;c&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="err">}</span><span class="w">                                </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+--------------------------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_MERGE_PRESERVE</span><span class="p">(</span><span class="s1">&#39;{ &#34;a&#34;: 1, &#34;b&#34;: 2 }&#39;</span><span class="p">,</span><span class="s1">&#39;{ &#34;a&#34;: 3, &#34;c&#34;: 4 }&#39;</span><span class="p">,</span><span class="s1">&#39;{ &#34;a&#34;: 5, &#34;d&#34;: 6 }&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+-------------------------------------------------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_MERGE_PRESERVE</span><span class="p">(</span><span class="s1">&#39;{ &#34;a&#34;: 1, &#34;b&#34;: 2 }&#39;</span><span class="p">,</span><span class="s1">&#39;{ &#34;a&#34;: 3, &#34;c&#34;: 4 }&#39;</span><span class="p">,</span><span class="s1">&#39;{ &#34;a&#34;: 5, &#34;d&#34;: 6 }&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+-------------------------------------------------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="s2">&#34;a&#34;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">],</span><span class="w"> </span><span class="s2">&#34;b&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;c&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;d&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="err">}</span><span class="w">                                         	  </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+-------------------------------------------------------------------------------------+</span><span class="w">
</span></span></span></code></pre></div><h3 id="json_remove">JSON_REMOVE</h3>
<p><code>JSON_REMOVE(json_doc, path[, path] ...)</code></p>
<p>该函数用于从 <code>json_doc</code> 中删除数据并返回结果，<code>path</code> 为路径参数。如果任何参数为 <code>NULL</code>，则返回 <code>NULL</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_REMOVE</span><span class="p">(</span><span class="s1">&#39;[&#34;a&#34;, [&#34;b&#34;, &#34;c&#34;], &#34;d&#34;]&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$[1]&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+-------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_REMOVE</span><span class="p">(</span><span class="o">@</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$[1]&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+-------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;a&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;d&#34;</span><span class="p">]</span><span class="w">              </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+-------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="nf">JSON_REMOVE</span><span class="p">(</span><span class="s1">&#39;{&#34;a&#34;:&#34;aaa&#34;, &#34;b&#34;:&#34;bbb&#34;, &#34;c&#34;:&#34;ccc&#34;}&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.a&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+---------------------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_REMOVE</span><span class="p">(</span><span class="s1">&#39;{&#34;a&#34;:&#34;aaa&#34;, &#34;b&#34;:&#34;bbb&#34;, &#34;c&#34;:&#34;ccc&#34;}&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.a&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+---------------------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="s2">&#34;b&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;bbb&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;c&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;ccc&#34;</span><span class="err">}</span><span class="w">          		     		  </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+---------------------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="nf">JSON_REMOVE</span><span class="p">(</span><span class="s1">&#39;{&#34;a&#34;:&#34;aaa&#34;, &#34;b&#34;:&#34;bbb&#34;, &#34;c&#34;:&#34;ccc&#34;}&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.d&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+---------------------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_REMOVE</span><span class="p">(</span><span class="s1">&#39;{&#34;a&#34;:&#34;aaa&#34;, &#34;b&#34;:&#34;bbb&#34;, &#34;c&#34;:&#34;ccc&#34;}&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.d&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+---------------------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="s2">&#34;a&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;aaa&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;b&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;bbb&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;c&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;ccc&#34;</span><span class="err">}</span><span class="w">       			  </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+---------------------------------------------------------+</span><span class="w">
</span></span></span></code></pre></div><h3 id="json_replace">JSON_REPLACE</h3>
<p><code>JSON_REPLACE(json_doc, path, val[, path, val] ...)</code></p>
<p>该函数用于替换 <code>json_doc</code> 中的现有值并返回结果。</p>
<p>文档中现有路径的 <code>path:value</code> 对会用新值覆盖现有文档值。文档中不存在路径的 <code>path:value</code> 将被忽略且无效。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="kt">SET</span><span class="w"> </span><span class="o">@</span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;{ &#34;a&#34;: 1, &#34;b&#34;: [2, 3]}&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_REPLACE</span><span class="p">(</span><span class="o">@</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.a&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.c&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;[true, false]&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+-----------------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_REPLACE</span><span class="p">(</span><span class="o">@</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.a&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.c&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;[true, false]&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+-----------------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="s2">&#34;a&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;b&#34;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">]</span><span class="err">}</span><span class="w">                              </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+-----------------------------------------------------+</span><span class="w">
</span></span></span></code></pre></div><h3 id="json_set">JSON_SET</h3>
<p><code>JSON_SET(json_doc, path, val[, path, val] ...)</code></p>
<p>该函数用于在<code>json_doc</code>中插入或更新（有则覆盖，没有则新增）数据并返回结果。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="kt">SET</span><span class="w"> </span><span class="o">@</span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;{ &#34;a&#34;: 1, &#34;b&#34;: [2, 3]}&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">rows</span><span class="w"> </span><span class="n">affected</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_SET</span><span class="p">(</span><span class="o">@</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.a&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.c&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;[true, false]&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+--------------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_SET</span><span class="p">(</span><span class="o">@</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.a&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.c&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;[true, false]&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+--------------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="s2">&#34;a&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;b&#34;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">],</span><span class="w"> </span><span class="s2">&#34;c&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;[true, false]&#34;</span><span class="err">}</span><span class="w">     </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+--------------------------------------------------+</span><span class="w">
</span></span></span></code></pre></div><p><code>JSON_SET()</code>、 <code>JSON_INSERT()</code>和 <code>JSON_REPLACE()</code> 函数是相关的，它们的区别如下：</p>
<ul>
<li><a href="#JSON_SET" rel=""><code>JSON_SET()</code></a>
替换现有值并添加不存在的值。</li>
<li><a href="#JSON_INSERT" rel=""><code>JSON_INSERT()</code></a>
插入值而不替换现有值。</li>
<li><a href="#JSON_REPLACE" rel=""><code>JSON_REPLACE()</code></a>
 仅替换 现有值。</li>
</ul>
<h2 id="5-获取json文本属性">5. 获取JSON文本属性</h2>
<h3 id="json_depth">JSON_DEPTH</h3>
<p><code>JSON_DEPTH(json_doc)</code></p>
<p>返回 <code>json_doc</code>的最大深度 。</p>
<p>空数组、空对象或标量值的深度为 1。仅包含深度为 1 的元素的非空数组或仅包含深度为 1 的成员值的非空对象的深度为 2。否则，<code>json_doc</code> 的深度大于 2。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_DEPTH</span><span class="p">(</span><span class="s1">&#39;{}&#39;</span><span class="p">),</span><span class="w"> </span><span class="nf">JSON_DEPTH</span><span class="p">(</span><span class="s1">&#39;[]&#39;</span><span class="p">),</span><span class="w"> </span><span class="nf">JSON_DEPTH</span><span class="p">(</span><span class="s1">&#39;true&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+------------------+------------------+--------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_DEPTH</span><span class="p">(</span><span class="s1">&#39;{}&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_DEPTH</span><span class="p">(</span><span class="s1">&#39;[]&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_DEPTH</span><span class="p">(</span><span class="s1">&#39;true&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+------------------+------------------+--------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">                </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">                </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">                  </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+------------------+------------------+--------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_DEPTH</span><span class="p">(</span><span class="s1">&#39;[10, 20]&#39;</span><span class="p">),</span><span class="w"> </span><span class="nf">JSON_DEPTH</span><span class="p">(</span><span class="s1">&#39;[[], {}]&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+------------------------+------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_DEPTH</span><span class="p">(</span><span class="s1">&#39;[10, 20]&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_DEPTH</span><span class="p">(</span><span class="s1">&#39;[[], {}]&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+------------------------+------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">                      </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">                      </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+------------------------+------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_DEPTH</span><span class="p">(</span><span class="s1">&#39;[10, {&#34;a&#34;: 20}]&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+-------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_DEPTH</span><span class="p">(</span><span class="s1">&#39;[10, {&#34;a&#34;: 20}]&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+-------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">                             </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+-------------------------------+</span><span class="w">
</span></span></span></code></pre></div><h3 id="json_length">JSON_LENGTH</h3>
<p><code>JSON_LENGTH(json_doc[, path])</code></p>
<p>返回 <code>json_doc</code> 的长度，如果 <code>path</code> 给出参数，则返回由路径标识的文档中的值的长度，如果任何参数为 <code>NULL</code> 或 <code>path</code> 参数未标识文档中的值，则返回 <code>NULL</code></p>
<p><code>json_doc</code>的长度定义如下：</p>
<ul>
<li>标量的长度为 1。</li>
<li>数组的长度是数组元素的数量。</li>
<li>对象的长度是对象成员的数量。</li>
<li>不计算嵌套数组或对象的长度。</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_LENGTH</span><span class="p">(</span><span class="s1">&#39;[1, 2, {&#34;a&#34;: 3}]&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+---------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_LENGTH</span><span class="p">(</span><span class="s1">&#39;[1, 2, {&#34;a&#34;: 3}]&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+---------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="mi">3</span><span class="w">						          </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+---------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_LENGTH</span><span class="p">(</span><span class="s1">&#39;[1, 2, {&#34;a&#34;: 3, &#34;b&#34;: 4}, 5]&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$[2]&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+------------------------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_LENGTH</span><span class="p">(</span><span class="s1">&#39;[1, 2, {&#34;a&#34;: 3, &#34;b&#34;: 4}, 5]&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$[2]&#39;</span><span class="p">);</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+------------------------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="mi">3</span><span class="w">						                                     </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+------------------------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_LENGTH</span><span class="p">(</span><span class="s1">&#39;{&#34;a&#34;: 1, &#34;b&#34;: {&#34;c&#34;: 30}}&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+-----------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_LENGTH</span><span class="p">(</span><span class="s1">&#39;{&#34;a&#34;: 1, &#34;b&#34;: {&#34;c&#34;: 30}}&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+-----------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="mi">2</span><span class="w">                                       </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+-----------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_LENGTH</span><span class="p">(</span><span class="s1">&#39;{&#34;a&#34;: 1, &#34;b&#34;: {&#34;c&#34;: 30}}&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.b&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+------------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_LENGTH</span><span class="p">(</span><span class="s1">&#39;{&#34;a&#34;: 1, &#34;b&#34;: {&#34;c&#34;: 30}}&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.b&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+------------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">                                              </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+------------------------------------------------+</span><span class="w">
</span></span></span></code></pre></div><h3 id="json_type">JSON_TYPE</h3>
<p><code>JSON_TYPE(json_val)</code></p>
<p>该函数返回代表 <code>JSON</code> 值类型的 <code>utf8mb4</code> 字符串，如果参数为 <code>NULL</code>，则返回 <code>NULL</code>，如果参数不是有效的 <code>JSON</code> 值，则会报错</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="kt">SET</span><span class="w"> </span><span class="o">@</span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;{&#34;a&#34;: [10, true]}&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_TYPE</span><span class="p">(</span><span class="o">@</span><span class="n">j</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+---------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_TYPE</span><span class="p">(</span><span class="o">@</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+---------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="n">OBJECT</span><span class="w">        </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+---------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_TYPE</span><span class="p">(</span><span class="nf">JSON_EXTRACT</span><span class="p">(</span><span class="o">@</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.a&#39;</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_TYPE</span><span class="p">(</span><span class="nf">JSON_EXTRACT</span><span class="p">(</span><span class="o">@</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.a&#39;</span><span class="p">))</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="n">ARRAY</span><span class="w">                              </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_TYPE</span><span class="p">(</span><span class="nf">JSON_EXTRACT</span><span class="p">(</span><span class="o">@</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.a[0]&#39;</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+---------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_TYPE</span><span class="p">(</span><span class="nf">JSON_EXTRACT</span><span class="p">(</span><span class="o">@</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.a[0]&#39;</span><span class="p">))</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+---------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="kt">INTEGER</span><span class="w">                               </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+---------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_TYPE</span><span class="p">(</span><span class="nf">JSON_EXTRACT</span><span class="p">(</span><span class="o">@</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.a[1]&#39;</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+---------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_TYPE</span><span class="p">(</span><span class="nf">JSON_EXTRACT</span><span class="p">(</span><span class="o">@</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.a[1]&#39;</span><span class="p">))</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+---------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="n">BOOLEAN</span><span class="w">                               </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+---------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_TYPE</span><span class="p">(</span><span class="no">NULL</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+-----------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_TYPE</span><span class="p">(</span><span class="no">NULL</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+-----------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="no">NULL</span><span class="w">            </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+-----------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_TYPE</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">ERROR</span><span class="w"> </span><span class="mi">3146</span><span class="w"> </span><span class="p">(</span><span class="mi">22032</span><span class="p">):</span><span class="w"> </span><span class="n">Invalid</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">JSON</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">argument</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">to</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">json_type</span><span class="p">;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">JSON</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">JSON</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">required</span><span class="p">.</span><span class="w">
</span></span></span></code></pre></div><h3 id="json_valid">JSON_VALID</h3>
<p><code>JSON_VALID(val)</code></p>
<p>该函数验证<code>val</code> 是否是有效的<code>JSON</code>, 是有效<code>JSON</code>则返回 0 否则返回 1 ，如果参数为<code>NULL</code>则 返回<code>NULL</code>。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_VALID</span><span class="p">(</span><span class="s1">&#39;{&#34;a&#34;: 1}&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_VALID</span><span class="p">(</span><span class="s1">&#39;{&#34;a&#34;: 1}&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">                      </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">JSON_VALID</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">),</span><span class="w"> </span><span class="nf">JSON_VALID</span><span class="p">(</span><span class="s1">&#39;&#34;hello&#34;&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+---------------------+-----------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_VALID</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_VALID</span><span class="p">(</span><span class="s1">&#39;&#34;hello&#34;&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+---------------------+-----------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">                   </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">                     </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+---------------------+-----------------------+</span><span class="w">
</span></span></span></code></pre></div><h2 id="6-json聚合函数">6. JSON聚合函数</h2>
<h3 id="json_arrayagg">JSON_ARRAYAGG</h3>
<p><code>JSON_ARRAYAGG(col_or_expr) [over_clause]</code></p>
<p>该函数配合 <code>GROUP BY</code> 进行分组后将结果集聚合为单个 <code>JSON</code> 数组，其元素由行组成。此数组中元素的顺序未定义。该函数作用于计算为单个值的列或表达式。参数 <code>col_or_expr </code>为列或表达式。如果结果不包含行，或者出现错误，则返回 <code>NULL</code></p>
<p><a href="https://dev.mysql.com/doc/refman/8.0/en/window-functions-usage.html" target="_blank" rel="noopener noreffer"><code>over_clause</code></a>
 从 <strong>MySQL 8.0.14</strong> 开始，如果存在，此函数将作为窗口函数执行。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">o_id</span><span class="p">,</span><span class="w"> </span><span class="n">attribute</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">t3</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+------+-----------+-------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="n">o_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">attribute</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+------+-----------+-------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">color</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">red</span><span class="w">   </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">fabric</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">silk</span><span class="w">  </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">    </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">color</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">green</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">    </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">shape</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">square</span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+------+-----------+-------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">4</span><span class="w"> </span><span class="n">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">o_id</span><span class="p">,</span><span class="w"> </span><span class="nf">JSON_ARRAYAGG</span><span class="p">(</span><span class="n">attribute</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">attributes</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">t3</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">o_id</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+------+---------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="n">o_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">attributes</span><span class="w">          </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+------+---------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;color&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;fabric&#34;</span><span class="p">]</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">    </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;color&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;shape&#34;</span><span class="p">]</span><span class="w">  </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+------+---------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">2</span><span class="w"> </span><span class="n">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></div><h3 id="json_objectagg">JSON_OBJECTAGG</h3>
<p><code>JSON_OBJECTAGG(key, value) [over_clause]</code></p>
<p>该函数配合 <code>GROUP BY</code> 进行分组后将两个列名或表达式作为参数，第一个用作键，第二个用作值，并返回包含键值对的 <code>JSON</code> 对象</p>
<p><a href="https://dev.mysql.com/doc/refman/8.0/en/window-functions-usage.html" target="_blank" rel="noopener noreffer"><code>over_clause</code></a>
 从 <strong>MySQL 8.0.14</strong> 开始，如果存在，此函数将作为窗口函数执行。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">o_id</span><span class="p">,</span><span class="w"> </span><span class="n">attribute</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">t3</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+------+-----------+-------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="n">o_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">attribute</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+------+-----------+-------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">color</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">red</span><span class="w">   </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">fabric</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">silk</span><span class="w">  </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">    </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">color</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">green</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">    </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">shape</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">square</span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+------+-----------+-------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">4</span><span class="w"> </span><span class="n">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">o_id</span><span class="p">,</span><span class="w"> </span><span class="nf">JSON_OBJECTAGG</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">t3</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">o_id</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+------+---------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="n">o_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nf">JSON_OBJECTAGG</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w">      </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+------+---------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="s2">&#34;color&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;red&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;fabric&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;silk&#34;</span><span class="err">}</span><span class="w">    </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">    </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="s2">&#34;color&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;green&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;shape&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;square&#34;</span><span class="err">}</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+------+---------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">2</span><span class="w"> </span><span class="n">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></div><h2 id="7-相关文档">7. 相关文档</h2>
<ul>
<li><a href="https://dev.mysql.com/doc/refman/5.7/en/json-function-reference.html" target="_blank" rel="noopener noreffer">官方文档</a>
</li>
</ul>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2023-12-01</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="http://example.org/posts/mysql/json-function-reference/" data-title="一问了解MySQL JSON相关函数" data-via="xxxx" data-hashtags="MySQL,JSON"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="http://example.org/posts/mysql/json-function-reference/" data-hashtag="MySQL"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Hacker News" data-sharer="hackernews" data-url="http://example.org/posts/mysql/json-function-reference/" data-title="一问了解MySQL JSON相关函数"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Line" data-sharer="line" data-url="http://example.org/posts/mysql/json-function-reference/" data-title="一问了解MySQL JSON相关函数"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@6.20.0/icons/line.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on 微博" data-sharer="weibo" data-url="http://example.org/posts/mysql/json-function-reference/" data-title="一问了解MySQL JSON相关函数"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/mysql/">MySQL</a>,&nbsp;<a href="/tags/json/">JSON</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/my-first-post/" class="prev" rel="prev" title="Markdown 基本语法 1"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>Markdown 基本语法 1</a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2020 - 2023</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">V3NN</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/contrib/copy-tex.min.css"><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.1/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/contrib/auto-render.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/contrib/copy-tex.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/contrib/mhchem.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":60},"comment":{},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
